<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Stats — {{ video_id }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{ background:#fff; color:#0a0a0a; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace; }
    .muted{ color:#6c757d; }
    .stat-card{ padding:.75rem; border:1px solid #e6e6e6; border-radius:.5rem; background:#fff; }
    .gain-pos{ color: #0b7a09; font-weight:600; }
    .gain-neg{ color: #9a0808; font-weight:600; }
  </style>
</head>
<body>
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('video_detail', video_id=video_id) }}">← Back</a>
      <span class="ms-2 mono">{{ video_id }}</span>
    </div>
    <div>
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('home') }}">Home</a>
    </div>
  </div>

  <div class="row g-3">
        <div class="col-12 col-lg-6">
      <h5>Daily (IST, 22:30 cut)</h5>
      <div class="stat-card mb-3">
        <div class="small muted mb-2">Daily gain is value at 22:30 IST each day — i.e. gain = value(D @ 22:30 IST) − value((D-1) @ 22:30 IST). Values shown in millions.</div>
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr><th>Date (IST)</th><th>Daily gain</th><th>End views (22:30)</th></tr>
            </thead>
            <tbody>
              {% for d in daily %}
                <tr>
                  <td class="mono">{{ d.ist_date }}</td>
                  <td>
                    {% if d.daily_gain is none %}
                      <span class="muted">—</span>
                    {% else %}
                      {% set v = d.daily_gain %}
                      {% if v >= 0 %}
                        <span class="gain-pos">{{ ('{:.2f}'.format(v/1000000.0)) }}M</span>
                      {% else %}
                        <span class="gain-neg">{{ ('{:.2f}'.format(v/1000000.0)) }}M</span>
                      {% endif %}
                    {% endif %}
                  </td>
                  <td class="mono">{{ "{:,}".format(d.end_views) if d.end_views is not none else "—" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <h5>Hourly (IST) — {{ selected_date }}</h5>
      <div class="d-flex gap-2 mb-2 align-items-center">
        <form method="get" action="{{ url_for('video_stats', video_id=video_id) }}" class="d-flex gap-2">
          <select name="date" class="form-select form-select-sm" style="min-width:170px;">
            {% for d in ist_dates %}
              <option value="{{ d }}" {% if d == selected_date %}selected{% endif %}>{{ d }}</option>
            {% endfor %}
          </select>
          <button class="btn btn-sm btn-primary" type="submit">Show</button>
        </form>
        <div class="ms-auto small muted">Times: IST (hours are rounded ranges)</div>
      </div>

      <div class="stat-card">
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr><th>Hour (IST)</th><th>End views</th><th>Hourly gain</th></tr>
            </thead>
            <tbody>
              {% for h in hourly %}
                <tr>
                  <td class="mono">{{ h.label }}</td>
                  <td class="mono">{{ "{:,}".format(h.end_views) if h.end_views is not none else "—" }}</td>
                  <td>
                    {% if h.hour_gain is none %}
                      <span class="muted">—</span>
                    {% else %}
                      {% set g = h.hour_gain %}
                      {% if g >= 0 %}
                        <span class="gain-pos">{{ "{:,}".format(g) }}</span>
                      {% else %}
                        <span class="gain-neg">{{ "{:,}".format(g) }}</span>
                      {% endif %}
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <footer class="mt-4 text-center muted">Daily dates converted to EST; hourly shown in IST. Values use stored samples and interpolation where needed.</footer>
</div>
</body>
</html>
